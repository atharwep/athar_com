<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฃุซุฑ | ุงูููู ุงูุชุนุฑููู ููููุธูุฉ (Org CV)</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="protection.js"></script>
    <script src="js/modules/auth_guard.js"></script> <!-- Will create this next -->
</head>

<body class="light-theme">
    <div class="org-header"
        style="background: linear-gradient(135deg, #1e293b 0%, #334155 100%); color: white; padding: 40px 0;">
        <div class="page-container">
            <h1>๐ข ุจูุงุก ุงููุฏุฑุงุช ุงููุคุณุณูุฉ (Capability Statement)</h1>
            <p>ุฃูุดุฆ ูููุงู ุชุนุฑูููุงู ุงุญุชุฑุงููุงู ูููุธูุชู ุฌุงูุฒุงู ููุชูุฏูู ูููุงูุญูู (USAID, ECHO, UN).</p>
        </div>
    </div>

    <div class="page-container" style="margin-top: -30px;">
        <div style="background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">

            <div class="form-section">
                <h3>๐ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                    <input type="text" id="orgName" placeholder="ุงุณู ุงูููุธูุฉ (ูุซุงู: ุฃุซุฑ ููุฅุบุงุซุฉ)" class="input-field">
                    <input type="text" id="orgSector" placeholder="ุงููุทุงุนุงุช (ูุซุงู: ุงูุชุนูููุ ุงูุตุญุฉ)" class="input-field">
                </div>
                <textarea id="orgHistory" rows="4" placeholder="ูุจุฐุฉ ุชุงุฑูุฎูุฉ ูุฑุคูุฉ ุงูููุธูุฉ..." class="input-field"
                    style="margin-top:15px; width:100%;"></textarea>
            </div>

            <div class="form-section" style="margin-top:20px;">
                <h3>๐ ุงูุฎุจุฑุฉ ูุงููุตูู</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                    <input type="text" id="orgBudget" placeholder="ุงูููุฒุงููุฉ ุงูุณูููุฉ (ุชูุฑูุจูุฉ)" class="input-field">
                    <input type="text" id="orgDonors" placeholder="ุฃุจุฑุฒ ุงููุงูุญูู ุงูุณุงุจููู" class="input-field">
                </div>
                <textarea id="orgProjects" rows="4"
                    placeholder="ุฃูู 3 ูุดุงุฑูุน ุชู ุชูููุฐูุง (ุงุณู ุงููุดุฑูุน - ุงููููู - ุงูุฃุซุฑ)..." class="input-field"
                    style="margin-top:15px; width:100%;"></textarea>
            </div>

            <button onclick="generateOrgCV()" class="btn btn-primary"
                style="width:100%; margin-top:30px; padding:15px; font-size:1.2rem;">โจ ุชูููุฏ ุงูููู ุงูุชุนุฑููู ุจุงูุฐูุงุก
                ุงูุงุตุทูุงุนู</button>
        </div>

        <div id="resultArea"
            style="display:none; margin-top:40px; background:white; padding:40px; border-radius:15px; border:1px solid #ddd;">
            <div class="cv-header" style="border-bottom:2px solid #334155; padding-bottom:20px; margin-bottom:20px;">
                <h2 id="resName" style="color:#1e293b; margin:0;"></h2>
                <span id="resSlogan" style="color:#64748b; font-style:italic;"></span>
            </div>

            <div class="cv-grid" style="display:grid; grid-template-columns: 2fr 1fr; gap:30px;">
                <!-- Main Content -->
                <div>
                    <h4 class="section-head">๐ ูู ูุญู (Who We Are)</h4>
                    <p id="resAbout"></p>

                    <h4 class="section-head">๐๏ธ ุงููุฏุฑุงุช ุงูุชูููุฉ (Technical Expertise)</h4>
                    <ul id="resExpertise"></ul>

                    <h4 class="section-head">๐ ุณูุงุจู ุงูุฎุจุฑุฉ (Past Performance)</h4>
                    <div id="resProjects"></div>
                </div>

                <!-- Sidebar -->
                <div style="background:#f8fafc; padding:20px; border-radius:10px;">
                    <h4 class="section-head" style="margin-top:0;">๐ ุญูุงุฆู ูุฃุฑูุงู</h4>
                    <div id="resStats"></div>

                    <h4 class="section-head">๐ค ุดุฑูุงุคูุง</h4>
                    <div id="resPartners"></div>
                </div>
            </div>

            <button onclick="window.print()" class="btn btn-ghost" style="margin-top:30px; width:100%;">๐จ๏ธ ุทุจุงุนุฉ /
                ุชุตุฏูุฑ PDF</button>
        </div>
    </div>

    <script>
        async function generateOrgCV() {
            const name = document.getElementById('orgName').value;
            const sector = document.getElementById('orgSector').value;
            const history = document.getElementById('orgHistory').value;
            const projects = document.getElementById('orgProjects').value;

            if (!name || !history) return alert("ูุฑุฌู ููุก ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ");

            const btn = document.querySelector('button[onclick="generateOrgCV()"]');
            btn.disabled = true;
            btn.innerText = "ุฌุงุฑู ุตูุงุบุฉ ุงูููู ุจุงุญุชุฑุงููุฉ...";

            // AI Logic Simulate (Connecting to same bridge pattern)
            const prompt = `
            ุฃูุช ุฎุจูุฑ ุชุทููุฑ ูุคุณุณู (Business Development). ูู ุจุตูุงุบุฉ Capability Statement ูููุธูุฉ ุบูุฑ ุฑุจุญูุฉ.
            
            ุงูุจูุงูุงุช:
            - ุงูุงุณู: ${name}
            - ุงููุทุงุน: ${sector}
            - ูุจุฐุฉ: ${history}
            - ูุดุงุฑูุน: ${projects}

            ุงููุทููุจ (JSON):
            {
                "slogan": "ุดุนุงุฑ ูููู ููุชุฑุญ",
                "about_professional": "ุตูุงุบุฉ ุงุญุชุฑุงููุฉ ููุณู ูู ูุญู (100 ูููุฉ)",
                "expertise_points": ["ููุทุฉ ููุฉ 1", "ููุทุฉ ููุฉ 2", "ููุทุฉ 3"],
                "projects_formatted": [
                    {"title": "ูุดุฑูุน 1", "desc": "ูุตู ุงูุฃุซุฑ"}
                ],
                "stats_inference": ["ุฅุญุตุงุฆูุฉ ูุณุชูุชุฌุฉ 1", "ุฅุญุตุงุฆูุฉ 2"]
            }
            `;

            try {
                // Using existing bridge pattern
                const BRIDGE_URL = "https://script.google.com/macros/s/AKfycbyJ0h6WymswhfwgB0-zylCW9YfDknGE7oXR2QQE8QlonM36Tw7qCAH-_szOIE2XpaW0eg/exec";
                const res = await fetch(`${BRIDGE_URL}?action=ai`, {
                    method: "POST",
                    headers: { "Content-Type": "text/plain;charset=utf-8" },
                    body: JSON.stringify({
                        model: "llama-3.3-70b-versatile",
                        messages: [{ role: "user", content: prompt + "\n\nIMPORTANT: Return ONLY valid JSON." }]
                    })
                });

                const text = await res.text();
                const json = JSON.parse(text.replace(/```json\s*|```\s*/gi, "").match(/\{[\s\S]*\}/)[0]);

                // Render
                document.getElementById('resName').innerText = name;
                document.getElementById('resSlogan').innerText = json.slogan;
                document.getElementById('resAbout').innerText = json.about_professional;

                document.getElementById('resExpertise').innerHTML = json.expertise_points.map(p => `<li>${p}</li>`).join('');
                document.getElementById('resProjects').innerHTML = json.projects_formatted.map(p => `<p><strong>${p.title}:</strong> ${p.desc}</p>`).join('');
                document.getElementById('resStats').innerHTML = json.stats_inference.map(s => `<div style="margin-bottom:10px;">๐ ${s}</div>`).join('');
                document.getElementById('resPartners').innerText = document.getElementById('orgDonors').value || "ุบูุฑ ูุญุฏุฏ";

                document.getElementById('resultArea').style.display = 'block';

            } catch (e) {
                alert("ุฎุทุฃ: " + e.message);
            } finally {
                btn.disabled = false;
                btn.innerText = "โจ ุชูููุฏ ุงูููู ุงูุชุนุฑููู ุจุงูุฐูุงุก ุงูุงุตุทูุงุนู";
            }
        }
    </script>
    <style>
        .input-field {
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            width: 100%;
            font-family: 'Cairo';
        }

        .section-head {
            color: #334155;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 5px;
            margin-top: 20px;
        }
    </style>
</body>

</html>