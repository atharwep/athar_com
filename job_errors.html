<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø«Ø± | Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù‚Ø§ØªÙ„Ø© ÙÙŠ Ø§Ù„ØªÙˆØ¸ÙŠÙ</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="protection.js"></script>
    <style>
        .page-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }

        .input-card {
            background: var(--glass-bg);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            margin-bottom: 30px;
        }

        textarea,
        input {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            margin-bottom: 15px;
            font-family: 'Cairo';
        }

        .btn-full {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            border: none;
            background: #e11d48;
            color: white;
            transition: 0.3s;
        }

        .result-card {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 15px;
            display: none;
            line-height: 1.8;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .error-item {
            background: #fff1f2;
            border-right: 5px solid #e11d48;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .solution-item {
            background: #f0fdf4;
            border-right: 5px solid #10b981;
            padding: 10px 15px;
            margin-top: 10px;
            border-radius: 5px;
            font-size: 0.9rem;
        }
    </style>
</head>

<body class="light-theme">
    <nav>
        <div class="logo-container">
            <a href="index.html" style="text-decoration:none; display:flex; align-items:center; gap:10px;">
                <img src="ØªÙ†Ø²ÙŠÙ„.jpg" alt="Logo" style="width:40px; border-radius:5px;">
                <div class="logo">Ø£Ø«Ù€Ù€Ù€Ù€Ù€Ø±</div>
            </a>
        </div>
        <div class="nav-actions">
            <a href="index.html" class="btn btn-ghost">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="career_path.html" class="btn btn-ghost">Ù…Ø³Ø§Ø±Ùƒ Ø§Ù„Ù…Ù‡Ù†ÙŠ</a>
        </div>
    </nav>

    <div class="page-container">
        <header style="text-align:center; margin-bottom:40px;">
            <h1 style="font-weight:900; color:#e11d48; font-size: 2.5rem;">âš ï¸ Ù…Ø­Ù„Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ ÙˆØ§Ù„Ø±ÙØ¶ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</h1>
            <p style="color:var(--text-secondary);">Ø§ÙƒØªØ´Ù Ù„Ù…Ø§Ø°Ø§ ÙŠØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨Ø§ØªÙƒ ÙÙŠ Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª ÙˆÙƒÙŠÙ ØªØµØ­Ø­ Ø§Ù„Ù…Ø³Ø§Ø± ÙÙˆØ±Ø§Ù‹.</p>
        </header>

        <div class="input-card">
            <div class="form-group">
                <label>Ø§Ø±ÙØ¹ Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ø°Ø§ØªÙŠØ© Ø£Ùˆ Ø§Ù„ØµÙ‚ Ù…Ø­ØªÙˆØ§Ù‡Ø§:</label>
                <textarea id="cvContent" rows="6" placeholder="Ø§Ù„ØµÙ‚ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù€ CV Ù‡Ù†Ø§ Ù„Ù„ØªØ­Ù„ÙŠÙ„..."></textarea>
            </div>
            <div class="form-group">
                <label>ÙƒÙ… Ù…Ø±Ø© Ù‚Ù…Øª Ø¨Ø§Ù„ØªÙ‚Ø¯ÙŠÙ… ÙˆÙ„Ù… ÙŠØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒØŸ</label>
                <input type="number" id="applyCount" placeholder="Ù…Ø«Ø§Ù„: 10">
            </div>
            <button id="analyzeErrorsBtn" class="btn-full">ÙƒØ´Ù Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù‚Ø§ØªÙ„Ø© âš¡</button>
        </div>

        <div id="statusLog" style="text-align:center; margin-bottom:20px; font-weight:bold;"></div>

        <div id="resultArea" class="result-card">
            <h3 style="color:#e11d48; border-bottom: 2px solid #eee; padding-bottom:10px;">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø±ÙØ¶ ÙˆØ§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ØªØµØ­ÙŠØ­ÙŠØ©
            </h3>
            <div id="errorsContainer"></div>
            <button id="exportBtn" class="btn btn-ghost" style="margin-top:20px; width:100%; border:1px solid #ddd;">ğŸ“¥
                Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªØµØ­ÙŠØ­ÙŠ</button>
        </div>
    </div>

    <script>
        const BRIDGE_URL = "https://script.google.com/macros/s/AKfycbzCic7XWHobosbwc4PR7_zoS1aZqO6u2UO2-C5Sjm1Nrk7S_iKiCekYa-2Mz84tz-RC/exec";

        document.getElementById('analyzeErrorsBtn').onclick = async () => {
            const cv = document.getElementById('cvContent').value;
            const count = document.getElementById('applyCount').value;

            const btn = document.getElementById('analyzeErrorsBtn');
            const status = document.getElementById('statusLog');
            btn.disabled = true;
            status.innerText = "â³ Ø¬Ø§Ø±ÙŠ ØªØ´Ø±ÙŠØ­ Ù…Ù„ÙÙƒ Ø§Ù„Ù…Ù‡Ù†ÙŠ Ù„ÙƒØ´Ù Ø§Ù„Ø«ØºØ±Ø§Øª...";

            const prompt = `
            Ø£Ù†Øª Ù…Ø³Ø¤ÙˆÙ„ ØªÙˆØ¸ÙŠÙ Ø®Ø¨ÙŠØ± (Senior Recruiter) ÙÙŠ Ø§Ù„Ø£Ù…Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø©.
            Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª: CV: ${cv}, Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø±ÙØ¶: ${count}.
            
            Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (JSON Ø­ØµØ±Ø§Ù‹):
            {
                "fatal_errors": [
                    {"error": "ÙˆØµÙ Ø¯Ù‚ÙŠÙ‚ Ù„Ù„Ø®Ø·Ø£ Ø§Ù„Ù‚Ø§ØªÙ„ (50 ÙƒÙ„Ù…Ø©)", "reason": "Ù„Ù…Ø§Ø°Ø§ ÙŠØ³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ Ø§Ù„ÙÙˆØ±ÙŠØŸ", "fix": "Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„Ø¹Ù…Ù„ÙŠ"}
                ],
                "hidden_issues": ["Ù…Ø´ÙƒÙ„Ø© Ø®ÙÙŠØ© 1", "Ù…Ø´ÙƒÙ„Ø© Ø®ÙÙŠØ© 2", "Ù…Ø´ÙƒÙ„Ø© Ø®ÙÙŠØ© 3", "Ù…Ø´ÙƒÙ„Ø© Ø®ÙÙŠØ© 4"],
                "cv_score": "Ù†Ø³Ø¨Ø© Ù…Ø¦ÙˆÙŠØ©",
                "urgent_advice": "Ø®Ø·Ø© Ø¥Ù†Ù‚Ø§Ø° Ø¹Ø§Ø¬Ù„Ø© (100 ÙƒÙ„Ù…Ø©)"
            }

            âš ï¸ ØªØ¹Ù„ÙŠÙ…Ø§Øª ØµØ§Ø±Ù…Ø©:
            1. Ø§Ø³ØªØ®Ø±Ø¬ **7 Ø£Ø®Ø·Ø§Ø¡ Ù‚Ø§ØªÙ„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„**.
            2. ÙƒÙ† ØµØ±ÙŠØ­Ø§Ù‹ ÙˆÙ‚Ø§Ø³ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù†Ù‚Ø¯ (Brutal Honesty) Ù„Ù…ØµÙ„Ø­Ø© Ø§Ù„Ù…Ø±Ø´Ø­.
            3. Ø±ÙƒØ² Ø¹Ù„Ù‰: Ø§Ù„Ù€ ATSØŒ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©ØŒ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ØŒ ØµÙŠØ§ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª.
            4. Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.
            `;

            const tryParse = (str) => {
                try { return JSON.parse(str); } catch (e) { return null; }
            };

            const cleanText = (text) => {
                let clean = text.replace(/```json\s*|```\s*/gi, "").trim();
                const start = clean.indexOf('{');
                const end = clean.lastIndexOf('}');
                if (start !== -1 && end !== -1 && end > start) {
                    return clean.substring(start, end + 1);
                }
                return clean;
            };

            try {
                const res = await fetch(BRIDGE_URL + "?action=ai", {
                    method: "POST",
                    headers: { "Content-Type": "text/plain;charset=utf-8" },
                    body: JSON.stringify({
                        model: "llama-3.3-70b-versatile",
                        messages: [{ role: "user", content: prompt + "\n\nIMPORTANT: Return ONLY valid JSON." }],
                        temperature: 0.3
                    })
                });

                const dataText = await res.text();
                if (!dataText) throw new Error("Empty response");

                let parsed = tryParse(dataText);
                let content = "";

                if (parsed && parsed.choices && parsed.choices[0] && parsed.choices[0].message) {
                    content = parsed.choices[0].message.content;
                } else {
                    content = dataText;
                }

                // (REMOVED generic error check to avoid false positives)
                if (content.startsWith("Error:") || content.includes("Rate limit exceeded")) {
                    status.innerText = "âš ï¸ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„Ø®Ø§Ø¯Ù… Ù…Ø´ØºÙˆÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¨Ø¹Ø¯ Ù‚Ù„ÙŠÙ„.";
                    return;
                }

                const json = tryParse(cleanText(content));
                if (!json) throw new Error("JSON Parsing failed");

                let html = `<div style="text-align:center; font-size:1.5rem; font-weight:bold; margin-bottom:20px;">Ø¯Ø±Ø¬Ø© Ø¬ÙˆØ¯Ø© Ù…Ù„ÙÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <span style="color:#e11d48;">${json.cv_score || '0%'}</span></div>`;

                (json.fatal_errors || []).forEach(e => {
                    html += `
                        <div class="error-item">
                            <strong style="color:#e11d48; font-size:1.1rem;">âŒ Ø§Ù„Ø®Ø·Ø£: ${e.error || ''}</strong>
                            <p style="margin:5px 0;"><strong>Ø§Ù„Ø³Ø¨Ø¨:</strong> ${e.reason || ''}</p>
                            <div class="solution-item"><strong>âœ… Ø§Ù„ØªØµØ­ÙŠØ­:</strong> ${e.fix || ''}</div>
                        </div>
                    `;
                });

                html += `<div style="margin-top:20px; padding:15px; background:#fff7ed; border-radius:10px;"><strong>ğŸ’¡ Ù…Ø´Ø§ÙƒÙ„ Ø¥Ø¶Ø§ÙÙŠØ©:</strong> ${(json.hidden_issues || []).join(' | ')}</div>`;
                html += `<div style="margin-top:20px; font-weight:bold; color:#1e40af;">ğŸ“Œ Ù†ØµÙŠØ­Ø© Ø¹Ø§Ø¬Ù„Ø©: ${json.urgent_advice || ''}</div>`;

                document.getElementById('errorsContainer').innerHTML = html;
                document.getElementById('resultArea').style.display = 'block';
                status.innerText = "âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„ÙØ­Øµ!";
            } catch (e) {
                console.error("AI Error:", e);
                status.innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.";
            } finally {
                btn.disabled = false;
            }
        };
        document.getElementById('exportBtn').onclick = () => {
            ProtectionManager.verify(() => window.print());
        };
    </script>
</body>

</html>