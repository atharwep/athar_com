<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø«Ø± | ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø®Ø¨Ø±Ø§Øª Ù„Ù„Ù…Ù†Ø¸Ù…Ø§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="protection.js"></script>
    <style>
        .page-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }

        .input-card {
            background: var(--glass-bg);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            margin-bottom: 30px;
        }

        textarea,
        input,
        select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            margin-bottom: 15px;
            font-family: 'Cairo';
        }

        .btn-full {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            border: none;
            background: var(--primary);
            color: white;
            transition: 0.3s;
        }

        .result-card {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 15px;
            display: none;
            line-height: 1.8;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 5px;
            margin: 25px 0 10px;
            font-weight: 900;
        }

        .transform-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .transform-table th,
        .transform-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: right;
        }

        .transform-table th {
            background: #f8fafc;
            color: var(--primary);
        }
    </style>
</head>

<body class="light-theme">
    <nav>
        <div class="logo-container">
            <a href="index.html" style="text-decoration:none; display:flex; align-items:center; gap:10px;">
                <img src="ØªÙ†Ø²ÙŠÙ„.jpg" alt="Logo" style="width:40px; border-radius:5px;">
                <div class="logo">Ø£Ø«Ù€Ù€Ù€Ù€Ù€Ø±</div>
            </a>
        </div>
        <div class="nav-actions">
            <a href="index.html" class="btn btn-ghost">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="career_path.html" class="btn btn-ghost">Ù…Ø³Ø§Ø±Ùƒ Ø§Ù„Ù…Ù‡Ù†ÙŠ</a>
            <a href="job_prep.html" class="btn btn-ghost">Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„Ù„Ù…Ù‚Ø§Ø¨Ù„Ø§Øª</a>
        </div>
    </nav>

    <div class="page-container">
        <header style="text-align:center; margin-bottom:40px;">
            <h1 style="font-weight:900; color:var(--primary); font-size: 2.5rem;">ğŸ”„ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø®Ø¨Ø±Ø§Øª Ù„Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ÙŠ</h1>
            <p style="color:var(--text-secondary);">Ø­ÙˆÙ„ Ø®Ø¨Ø±Ø§ØªÙƒ Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ© Ø£Ùˆ Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© Ø¥Ù„Ù‰ ØµÙŠØ§ØºØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© ØªÙ‚Ø¨Ù„Ù‡Ø§ Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª
                Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©.</p>
        </header>

        <div class="input-card">
            <div class="form-group">
                <label>Ù„ØµÙ‚ Ø®Ø¨Ø±Ø§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø£Ùˆ Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ø°Ø§ØªÙŠØ©:</label>
                <textarea id="rawExperience" rows="8"
                    placeholder="Ù…Ø«Ø§Ù„: Ø¹Ù…Ù„Øª Ù…Ù†Ø¯ÙˆØ¨ Ù…Ø¨ÙŠØ¹Ø§ØªØŒ Ù…Ø¯ÙŠØ± Ù…Ø¯Ø±Ø³Ø©ØŒ Ù…Ø­Ø§Ø³Ø¨ ÙÙŠ Ø´Ø±ÙƒØ© Ø®Ø§ØµØ©..."></textarea>
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù ÙÙŠ Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª:</label>
                <input type="text" id="targetJob" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø³Ø¤ÙˆÙ„ Ù„ÙˆØ¬Ø³ØªÙŠØ§ØªØŒ Ù…Ø³Ø¤ÙˆÙ„ Ø­Ù…Ø§ÙŠØ©ØŒ Ù…Ù†Ø³Ù‚ Ù…Ø´Ø§Ø±ÙŠØ¹...">
            </div>
            <button id="transformBtn" class="btn-full">ØªØ­Ù„ÙŠÙ„ ÙˆØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø®Ø¨Ø±Ø§Øª âš¡</button>
        </div>

        <div id="statusLog" style="text-align:center; margin-bottom:20px; font-weight:bold;"></div>

        <div id="resultArea" class="result-card">
            <div id="analysisContent"></div>
            <button id="exportBtn" class="btn btn-ghost" style="margin-top:20px; width:100%; border:1px solid #ddd;">ğŸ“¥
                ØªØµØ¯ÙŠØ± ÙƒØ¯Ù„ÙŠÙ„ ØµÙŠØ§ØºØ©</button>
        </div>
    </div>

    <script>
        const BRIDGE_URL = "https://script.google.com/macros/s/AKfycbzCic7XWHobosbwc4PR7_zoS1aZqO6u2UO2-C5Sjm1Nrk7S_iKiCekYa-2Mz84tz-RC/exec";

        document.getElementById('transformBtn').onclick = async () => {
            const exp = document.getElementById('rawExperience').value;
            const job = document.getElementById('targetJob').value;

            if (!exp) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø®Ø¨Ø±Ø§ØªÙƒ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©.");

            const btn = document.getElementById('transformBtn');
            const status = document.getElementById('statusLog');
            btn.disabled = true;
            status.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ù‡Ù†Ø¯Ø³Ø© Ø®Ø¨Ø±Ø§ØªÙƒ Ù„ØºÙˆÙŠØ§Ù‹...";

            const prompt = `
            Ø­ÙˆÙ„ Ø§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¥Ù„Ù‰ Ù„ØºØ© ØªØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© (INGO).
            Ø§Ù„Ø®Ø¨Ø±Ø©: ${exp}
            Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©: ${job}

            Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (JSON Ø­ØµØ±Ø§Ù‹):
            {
                "mapping": [
                    {"old": "Ø¬Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©", "new": "Ø¥Ø¹Ø§Ø¯Ø© ØµÙŠØ§ØºØ© Ø§Ø­ØªØ±Ø§ÙÙŠØ© (Action Verbs)", "skills": "Ù…Ù‡Ø§Ø±Ø§Øª Ù…Ø³ØªØ®Ù„ØµØ©"}
                ],
                "cv_phrases": ["Ø¥Ù†Ø¬Ø§Ø² 1 Ù…ØµØ§Øº Ø¨Ù€ STAR method", "Ø¥Ù†Ø¬Ø§Ø² 2"],
                "suggested_titles": ["Ù…Ø³Ù…Ù‰ 1", "Ù…Ø³Ù…Ù‰ 2"],
                "cv_sections": "Ù†ØµÙŠØ­Ø© Ù‡ÙŠÙƒÙ„ÙŠØ© (50 ÙƒÙ„Ù…Ø©)",
                "warnings": ["ØªØ¬Ù†Ø¨ Ø°ÙƒØ± ÙƒØ°Ø§..."],
                "boosters": ["Ø¯ÙˆØ±Ø© Ù…Ù‚ØªØ±Ø­Ø©"]
            }
            Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.
            `;

            try {
                const res = await fetch(BRIDGE_URL + "?action=ai", {
                    method: "POST",
                    headers: { "Content-Type": "text/plain;charset=utf-8" },
                    body: JSON.stringify({
                        model: "llama-3.3-70b-versatile",
                        messages: [{ role: "user", content: prompt }],
                        temperature: 0.7
                    })
                });

                const text = await res.text();
                // Check if response is HTML error page
                if (text.trim().startsWith("<")) throw new Error("Server Error (HTML Response)");

                // Cleanup JSON
                const cleanJson = text.replace(/```json\s*|```\s*/gi, "").trim();
                const jsonMatch = cleanJson.match(/\{[\s\S]*\}/);

                if (!jsonMatch) throw new Error("Invalid JSON from AI: " + text.substring(0, 50));

                const json = JSON.parse(jsonMatch[0]);

                let html = `
                    <div class="section-title">ğŸ“Š Ø¬Ø¯ÙˆÙ„ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…</div>
                    <table class="transform-table">
                        <tr><th>Ø§Ù„Ø®Ø¨Ø±Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</th><th>Ø§Ù„ØµÙŠØ§ØºØ© Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ÙŠØ©</th><th>Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©</th></tr>
                        ${(json.mapping || []).map(m => `<tr><td>${m.old}</td><td>${m.new}</td><td>${m.skills}</td></tr>`).join('')}
                    </table>

                    <div class="section-title">âœï¸ ØµÙŠØ§ØºØ§Øª Ø¬Ø§Ù‡Ø²Ø© Ù„Ø³ÙŠØ±ØªÙƒ Ø§Ù„Ø°Ø§ØªÙŠØ©</div>
                    <ul>${(json.cv_phrases || []).map(p => `<li>${p}</li>`).join('')}</ul>

                    <div class="section-title">ğŸ·ï¸ Ù…Ø³Ù…ÙŠØ§Øª ÙˆØ¸ÙŠÙÙŠØ© ØªÙ†Ø§Ø³Ø¨Ùƒ</div>
                    <p>${(json.suggested_titles || []).join(' - ')}</p>

                    <div class="section-title">ğŸ“‚ Ù†ØµÙŠØ­Ø© Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù€ CV</div>
                    <p>${json.cv_sections || ''}</p>

                    <div class="section-title">âš ï¸ Ø®Ø¨Ø±Ø§Øª ÙŠÙØ¶Ù„ ØªØ¬Ù†Ø¨Ù‡Ø§/ØªÙ‚Ù„ÙŠÙ„Ù‡Ø§</div>
                    <ul>${(json.warnings || []).map(w => `<li>${w}</li>`).join('')}</ul>

                    <div class="section-title">ğŸ“ˆ Ù„ØªØ¹Ø²ÙŠØ² Ù…Ù„ÙÙƒ ÙÙˆØ±Ø§Ù‹</div>
                    <p>${(json.boosters || []).join(' - ')}</p>
                `;

                document.getElementById('analysisContent').innerHTML = html;
                document.getElementById('resultArea').style.display = 'block';
                status.innerText = "âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„!";
            } catch (e) {
                console.error("Analysis Error:", e);
                status.innerHTML = `<span style="color:red">âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù„ÙŠÙ„: ${e.message}</span>`;
            } finally {
                btn.disabled = false;
            }
        };
        document.getElementById('exportBtn').onclick = () => {
            ProtectionManager.verify(() => window.print());
        };
    </script>
</body>

</html>