<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø«Ø± | Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="protection.js"></script>
    <style>
        .page-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }

        .input-card {
            background: var(--glass-bg);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            margin-bottom: 30px;
        }

        textarea,
        input,
        select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            margin-bottom: 15px;
            font-family: 'Cairo';
        }

        .btn-full {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            border: none;
            background: #ea580c;
            color: white;
            transition: 0.3s;
        }

        .result-card {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 15px;
            display: none;
            line-height: 1.8;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .scenario-box {
            background: #fff7ed;
            border-right: 5px solid #ea580c;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
    </style>
</head>

<body class="light-theme">
    <nav>
        <div class="logo-container">
            <a href="index.html" style="text-decoration:none; display:flex; align-items:center; gap:10px;">
                <img src="ØªÙ†Ø²ÙŠÙ„.jpg" alt="Logo" style="width:40px; border-radius:5px;">
                <div class="logo">Ø£Ø«Ù€Ù€Ù€Ù€Ù€Ø±</div>
            </a>
        </div>
    </nav>

    <div class="page-container">
        <header style="text-align:center; margin-bottom:40px;">
            <h1 style="font-weight:900; color:#ea580c; font-size: 2.5rem;">ğŸšœ Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ</h1>
            <p style="color:var(--text-secondary);">Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ Ù„Ù…ÙˆØ§Ø¬Ù‡Ø© ØªØ­Ø¯ÙŠØ§Øª Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ØŸ Ù„Ù†ÙƒØªØ´Ù Ø°Ù„Ùƒ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª
                Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠØ©.</p>
        </header>

        <div class="input-card">
            <div class="form-group">
                <label>ØªØ®ØµØµÙƒ Ø£Ùˆ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©:</label>
                <input type="text" id="targetJob" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø³Ø¤ÙˆÙ„ Ù…ÙŠØ§Ù‡ØŒ Ù…Ù†Ø³Ù‚ Ø³Ø¨Ù„ Ø¹ÙŠØ´...">
            </div>
            <div class="form-group">
                <label>ØµÙ Ø·Ø¨ÙŠØ¹Ø© Ø§Ù„Ø¨ÙŠØ¦Ø© Ø§Ù„ØªÙŠ ØªØ±ØºØ¨ Ø¨Ø§Ù„Ø¹Ù…Ù„ ÙÙŠÙ‡Ø§ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                <textarea id="envDesc" rows="3" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø®ÙŠÙ…Ø§ØªØŒ Ù…Ù†Ø§Ø·Ù‚ Ù†Ø²Ø§Ø¹ØŒ Ø±ÙŠÙ Ù†Ø§Ø¦ÙŠ..."></textarea>
            </div>
            <button id="checkReadyBtn" class="btn-full">ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¬Ø§Ù‡Ø²ÙŠØ© Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ© âš¡</button>
        </div>

        <div id="statusLog" style="text-align:center; margin-bottom:20px; font-weight:bold;"></div>

        <div id="resultArea" class="result-card">
            <div id="readinessContent"></div>
            <button id="exportBtn" class="btn btn-ghost" style="margin-top:20px; width:100%; border:1px solid #ddd;">ğŸ“¥
                ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ù‡Ù†ÙŠ</button>
        </div>
    </div>

    <script>
        const BRIDGE_URL = "https://script.google.com/macros/s/AKfycbzCic7XWHobosbwc4PR7_zoS1aZqO6u2UO2-C5Sjm1Nrk7S_iKiCekYa-2Mz84tz-RC/exec";

        document.getElementById('checkReadyBtn').onclick = async () => {
            const job = document.getElementById('targetJob').value;
            const env = document.getElementById('envDesc').value;

            const btn = document.getElementById('checkReadyBtn');
            const status = document.getElementById('statusLog');
            btn.disabled = true;
            status.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙƒØ§Ø© Ø¨ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ...";

            const prompt = `
            Ø£Ù†Øª Ù…Ø¯ÙŠØ± Ø¨Ø±Ø§Ù…Ø¬ Ù…ÙŠØ¯Ø§Ù†ÙŠ Ø¨Ø®Ø¨Ø±Ø© Ø·ÙˆÙŠÙ„Ø© ÙÙŠ Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©.
            Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª: Ø§Ù„ÙˆØ¸ÙŠÙØ© ${job}, Ø§Ù„Ø¨ÙŠØ¦Ø© ${env}.
            
            Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (JSON Ø­ØµØ±Ø§Ù‹):
            {
                "requirements": ["Ù…ØªØ·Ù„Ø¨ 1", "Ù…ØªØ·Ù„Ø¨ 2", "Ù…ØªØ·Ù„Ø¨ 3", "Ù…ØªØ·Ù„Ø¨ 4"],
                "office_vs_field": "Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØµØ¨ (100 ÙƒÙ„Ù…Ø©)",
                "scenarios": [
                    {"case": "Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ù…ÙŠØ¯Ø§Ù†ÙŠ Ø­Ù‚ÙŠÙ‚ÙŠ ÙˆÙ…ÙØµÙ„", "solution": "ÙƒÙŠÙ ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡ Ø¨Ø§Ø­ØªØ±Ø§ÙÙŠØ©ØŸ (Ø¥Ø¬Ø§Ø¨Ø© Ù…ÙØµÙ„Ø© 80-100 ÙƒÙ„Ù…Ø©)"}
                ],
                "risks": ["Ø®Ø·Ø± 1", "Ø®Ø·Ø± 2", "Ø®Ø·Ø± 3"],
                "mental_prep": "ÙƒÙŠÙ ØªØ³ØªØ¹Ø¯ Ù†ÙØ³ÙŠØ§Ù‹ØŸ (150 ÙƒÙ„Ù…Ø©)",
                "ready_score": "80%"
            }
            
            âš ï¸ Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹: ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ­ØªÙˆÙŠ Ù…ØµÙÙˆÙØ© scenarios Ø¹Ù„Ù‰ 20 Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø¨Ø§Ù„Ø¶Ø¨Ø·.
            Ù†ÙˆÙ‘Ø¹ Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ù„ØªØ´Ù…Ù„: ØªØ­Ø¯ÙŠØ§Øª Ù„ÙˆØ¬Ø³ØªÙŠØ©ØŒ Ù…Ø´Ø§ÙƒÙ„ Ø£Ù…Ù†ÙŠØ©ØŒ ØµØ±Ø§Ø¹Ø§Øª Ù…Ø¬ØªÙ…Ø¹ÙŠØ©ØŒ 
            Ø¶ØºÙˆØ· Ø§Ù„Ø¹Ù…Ù„ØŒ Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø´Ø±ÙƒØ§Ø¡ØŒ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø²Ù…Ø§ØªØŒ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†ØŒ Ø¥Ù„Ø®.
            Ø§Ø¬Ø¹Ù„ ÙƒÙ„ Ø­Ù„ Ù…ÙØµÙ„Ø§Ù‹ ÙˆØ¹Ù…Ù„ÙŠØ§Ù‹.
            Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.
            `;

            const tryParse = (str) => {
                try { return JSON.parse(str); } catch (e) { return null; }
            };

            const cleanText = (text) => {
                let clean = text.replace(/```json\s*|```\s*/gi, "").trim();
                const start = clean.indexOf('{');
                const end = clean.lastIndexOf('}');
                if (start !== -1 && end !== -1 && end > start) {
                    return clean.substring(start, end + 1);
                }
                return clean;
            };

            try {
                const res = await fetch(BRIDGE_URL + "?action=ai", {
                    method: "POST",
                    headers: { "Content-Type": "text/plain;charset=utf-8" },
                    body: JSON.stringify({
                        model: "llama-3.3-70b-versatile",
                        messages: [{ role: "user", content: prompt + "\n\nIMPORTANT: Return ONLY valid JSON." }],
                        temperature: 0.3
                    })
                });

                const dataText = await res.text();
                if (!dataText) throw new Error("Empty response");

                let parsed = tryParse(dataText);
                let content = "";

                if (parsed && parsed.choices && parsed.choices[0] && parsed.choices[0].message) {
                    content = parsed.choices[0].message.content;
                } else {
                    content = dataText;
                }

                // (Fixed) Removed false positive error check
                if (content.startsWith("Error:") || content.includes("Rate limit exceeded")) {
                    status.innerText = "âš ï¸ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„Ø®Ø§Ø¯Ù… Ù…Ø´ØºÙˆÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹.";
                    return;
                }

                const json = tryParse(cleanText(content));
                if (!json) throw new Error("JSON Parsing failed");

                let html = `
                    <div style="text-align:center; margin-bottom:20px;">
                        <div style="font-size:3rem;">ğŸšœ</div>
                        <h2 style="color:#ea580c;">Ø¬Ø§Ù‡Ø²ÙŠØªÙƒ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠØ©: ${json.ready_score || '0%'}</h2>
                    </div>

                    <h3 style="color:var(--primary); border-bottom:1px solid #ddd; padding-bottom:5px;">ğŸ“‹ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…ÙŠØ¯Ø§Ù†ÙŠ</h3>
                    <ul>${(json.requirements || []).map(r => `<li>${r}</li>`).join('')}</ul>

                    <p><strong>Ø§Ù„ÙØ±Ù‚ Ø§Ù„Ø¬ÙˆÙ‡Ø±ÙŠ:</strong> ${json.office_vs_field || ''}</p>

                    <h3 style="color:#ea580c; margin-top:20px;">ğŸŸï¸ Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆÙ‡Ø§Øª Ù…ÙŠØ¯Ø§Ù†ÙŠØ© ÙˆØ§Ù‚Ø¹ÙŠØ©</h3>
                    ${(json.scenarios || []).map(s => `
                        <div class="scenario-box">
                            <strong>âš ï¸ Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${s.case || ''}
                            <div style="margin-top:10px; color:#166534;"><strong>ğŸ’¡ Ø§Ù„Ø­Ù„ Ø§Ù„Ù…Ù‡Ù†ÙŠ:</strong> ${s.solution || ''}</div>
                        </div>
                    `).join('')}

                    <h3 style="color:#ef4444; margin-top:20px;">âš ï¸ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙˆÙƒÙŠÙÙŠØ© Ø¥Ø¯Ø§Ø±ØªÙ‡Ø§</h3>
                    <ul>${(json.risks || []).map(rk => `<li>${rk}</li>`).join('')}</ul>

                    <div style="padding:15px; background:#f0f9ff; border-radius:10px; margin-top:20px;">
                        <strong>ğŸ§  Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ø§Ù„Ù†ÙØ³ÙŠ:</strong> ${json.mental_prep || ''}
                    </div>
                `;

                document.getElementById('readinessContent').innerHTML = html;
                document.getElementById('resultArea').style.display = 'block';
                status.innerText = "âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…!";
            } catch (e) {
                console.error("AI Error:", e);
                status.innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.";
            } finally {
                btn.disabled = false;
            }
        };
        document.getElementById('exportBtn').onclick = () => {
            ProtectionManager.verify(() => window.print());
        };
    </script>
</body>

</html>