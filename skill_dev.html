<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø«Ø± | ØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª ÙˆØ¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø¯Ø±Ø§Øª</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="protection.js"></script>
    <style>
        .page-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
        }

        .input-card {
            background: var(--glass-bg);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            margin-bottom: 30px;
        }

        textarea,
        input,
        select {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--glass-border);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-primary);
            margin-bottom: 15px;
            font-family: 'Cairo';
        }

        .btn-full {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            border: none;
            background: var(--primary);
            color: white;
            transition: 0.3s;
        }

        .result-card {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 15px;
            display: none;
            line-height: 1.8;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 5px;
            margin: 25px 0 10px;
            font-weight: 900;
        }

        .skill-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .skill-item {
            background: #f1f5f9;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            border-right: 3px solid var(--primary);
        }
    </style>
</head>

<body class="light-theme">
    <nav>
        <div class="logo-container">
            <a href="index.html" style="text-decoration:none; display:flex; align-items:center; gap:10px;">
                <img src="ØªÙ†Ø²ÙŠÙ„.jpg" alt="Logo" style="width:40px; border-radius:5px;">
                <div class="logo">Ø£Ø«Ù€Ù€Ù€Ù€Ù€Ø±</div>
            </a>
        </div>
        <div class="nav-actions">
            <a href="index.html" class="btn btn-ghost">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="career_path.html" class="btn btn-ghost">Ù…Ø³Ø§Ø±Ùƒ Ø§Ù„Ù…Ù‡Ù†ÙŠ</a>
            <a href="job_prep.html" class="btn btn-ghost">Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ù„Ù„Ù…Ù‚Ø§Ø¨Ù„Ø§Øª</a>
        </div>
    </nav>

    <div class="page-container">
        <header style="text-align:center; margin-bottom:40px;">
            <h1 style="font-weight:900; color:var(--primary); font-size: 2.5rem;">ğŸ—ï¸ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù‚Ø¯Ø±Ø§Øª ÙˆØªØ·ÙˆÙŠØ± Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</h1>
            <p style="color:var(--text-secondary);">Ø®Ø±ÙŠØ·Ø© Ø·Ø±ÙŠÙ‚ Ø¹Ù„Ù…ÙŠØ© Ù„ØªØ·ÙˆÙŠØ± Ù…Ù‡Ø§Ø±Ø§ØªÙƒ Ø¨Ù…Ø§ ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª
                Ø§Ù„Ø­Ø¯ÙŠØ«Ø©.</p>
        </header>

        <div class="input-card">
            <div class="form-group">
                <label>Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù:</label>
                <select id="jobField">
                    <option value="Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹">Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</option>
                    <option value="Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª">Ø§Ù„Ù„ÙˆØ¬Ø³ØªÙŠØ§Øª</option>
                    <option value="Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©">Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</option>
                    <option value="Ø§Ù„Ù…Ø§Ù„ÙŠØ©">Ø§Ù„Ù…Ø§Ù„ÙŠØ©</option>
                    <option value="Ø§Ù„Ø­Ù…Ø§ÙŠØ©">Ø§Ù„Ø­Ù…Ø§ÙŠØ©</option>
                    <option value="Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…">Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ… (MEAL)</option>
                    <option value="ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª">ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</option>
                </select>
            </div>
            <div class="form-group">
                <label>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠ:</label>
                <select id="expLevel">
                    <option value="Ù…Ø¨ØªØ¯Ø¦">Ù…Ø¨ØªØ¯Ø¦ (Ø£Ø¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ ÙˆØ¸ÙŠÙØ©)</option>
                    <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø· (1-3 Ø³Ù†ÙˆØ§Øª Ø®Ø¨Ø±Ø©)</option>
                    <option value="Ù…ØªÙ‚Ø¯Ù…">Ù…ØªÙ‚Ø¯Ù… (Ø£ÙƒØ«Ø± Ù…Ù† 5 Ø³Ù†ÙˆØ§Øª)</option>
                </select>
            </div>
            <div class="form-group">
                <label>Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„ØªÙŠ ØªÙ…ØªÙ„ÙƒÙ‡Ø§ Ø­Ø§Ù„ÙŠØ§Ù‹ (Ø¥Ù† ÙˆØ¬Ø¯Øª):</label>
                <textarea id="currentSkills" rows="3"
                    placeholder="Ù…Ø«Ø§Ù„: Excel, Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©ØŒ Ù…Ù‡Ø§Ø±Ø§Øª ØªÙˆØ§ØµÙ„..."></textarea>
            </div>
            <button id="analyzeBtn" class="btn-full">ØªÙˆÙ„ÙŠØ¯ Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªØ·ÙˆÙŠØ± âš¡</button>
        </div>

        <div id="statusLog" style="text-align:center; margin-bottom:20px; font-weight:bold;"></div>

        <div id="resultArea" class="result-card">
            <div id="analysisContent"></div>
            <button id="exportBtn" class="btn btn-ghost" style="margin-top:20px; width:100%; border:1px solid #ddd;">ğŸ“¥
                ØªØ­Ù…ÙŠÙ„ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø·Ø±ÙŠÙ‚</button>
        </div>
    </div>

    <script>
        const BRIDGE_URL = "https://script.google.com/macros/s/AKfycbzCic7XWHobosbwc4PR7_zoS1aZqO6u2UO2-C5Sjm1Nrk7S_iKiCekYa-2Mz84tz-RC/exec";

        document.getElementById('analyzeBtn').onclick = async () => {
            const field = document.getElementById('jobField').value;
            const level = document.getElementById('expLevel').value;
            const skills = document.getElementById('currentSkills').value;

            const btn = document.getElementById('analyzeBtn');
            const status = document.getElementById('statusLog');
            btn.disabled = true;
            status.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø¨Ù†Ø§Ø¡ Ø®Ø±ÙŠØ·Ø© Ù…Ù‡Ø§Ø±Ø§ØªÙƒ Ø§Ù„Ù…Ø®ØµØµØ©...";

            const prompt = `
            Ø£Ù†Øª Ø®Ø¨ÙŠØ± Ø¨Ù†Ø§Ø¡ Ù‚Ø¯Ø±Ø§Øª ÙˆÙ…Ø·ÙˆØ± Ù…Ø³Ø§Ø±Ø§Øª ÙˆØ¸ÙŠÙÙŠØ© (Capacity Building Expert) ÙÙŠ Ø§Ù„Ù…Ù†Ø¸Ù…Ø§Øª Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©.
            Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª: Ø§Ù„Ù…Ø¬Ø§Ù„: ${field}, Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ${level}, Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª: ${skills}.

            Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ (JSON Ø­ØµØ±Ø§Ù‹):
            {
                "analysis": "ØªØ­Ù„ÙŠÙ„ Ø¹Ù…ÙŠÙ‚ Ù„Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙÙŠ Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¥Ù†Ø³Ø§Ù†ÙŠ",
                "core_skills": ["Ù…Ù‡Ø§Ø±Ø© Ø£Ø³Ø§Ø³ÙŠØ© 1", "Ù…Ù‡Ø§Ø±Ø© Ø£Ø³Ø§Ø³ÙŠØ© 2", "Ù…Ù‡Ø§Ø±Ø© 3", "Ù…Ù‡Ø§Ø±Ø© 4", "Ù…Ù‡Ø§Ø±Ø© 5"],
                "tech_skills": ["Ø£Ø¯ÙˆØ§Øª ØªÙ‚Ù†ÙŠØ© 1", "Ø£Ø¯ÙˆØ§Øª ØªÙ‚Ù†ÙŠØ© 2", "Ø£Ø¯ÙˆØ§Øª ØªÙ‚Ù†ÙŠØ© 3"],
                "soft_skills": ["Ù…Ù‡Ø§Ø±Ø© Ø³Ù„ÙˆÙƒÙŠØ© 1", "Ù…Ù‡Ø§Ø±Ø© Ø³Ù„ÙˆÙƒÙŠØ© 2", "Ù…Ù‡Ø§Ø±Ø© Ø³Ù„ÙˆÙƒÙŠØ© 3"],
                "learning_plan": {
                    "short_term": "Ø®Ø·Ø© ØªÙØµÙŠÙ„ÙŠØ© Ù„Ø£ÙˆÙ„ Ø´Ù‡Ø± (3 Ù†Ù‚Ø§Ø· Ø¹Ù…Ù„)",
                    "medium_term": "Ø®Ø·Ø© 3 Ø£Ø´Ù‡Ø± (Ù…Ø´Ø±ÙˆØ¹ Ø¹Ù…Ù„ÙŠ)",
                    "long_term": "Ø®Ø·Ø© 6 Ø£Ø´Ù‡Ø± (Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ù‚ØªØ±Ø­Ø©)"
                },
                "tools": ["Ù‚Ø§Ø¦Ù…Ø© Ø´Ø§Ù…Ù„Ø© Ø¨Ø§Ù„Ø¨Ø±Ø§Ù…Ø¬ ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø¬Ø§Ù„"],
                "certifications": ["Ø´Ù‡Ø§Ø¯Ø§Øª Ù…Ø¹ØªÙ…Ø¯Ø© ÙŠÙ†ØµØ­ Ø¨Ù‡Ø§ (PMD Pro, Sphere, etc.)"],
                "warnings": ["ÙØ¬ÙˆØ§Øª Ø®Ø·ÙŠØ±Ø© ÙŠØ¬Ø¨ ØªØ¬Ù†Ø¨Ù‡Ø§"]
            }
            ØªØ¹Ù„ÙŠÙ…Ø§Øª: Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ§Ø³Ø¹Ø© ÙˆØ´Ø§Ù…Ù„Ø© Ø¬Ø¯Ø§Ù‹ØŒ ØªØºØ·ÙŠ Ø§Ù„Ø¬ÙˆØ§Ù†Ø¨ Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ø´Ø®ØµÙŠØ©.
            Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©.
            `;

            const tryParse = (str) => {
                try { return JSON.parse(str); } catch (e) { return null; }
            };

            const cleanText = (text) => {
                let clean = text.replace(/```json\s*|```\s*/gi, "").trim();
                const start = clean.indexOf('{');
                const end = clean.lastIndexOf('}');
                if (start !== -1 && end !== -1 && end > start) {
                    return clean.substring(start, end + 1);
                }
                return clean;
            };

            try {
                const res = await fetch(BRIDGE_URL + "?action=ai", {
                    method: "POST",
                    headers: { "Content-Type": "text/plain;charset=utf-8" },
                    body: JSON.stringify({
                        model: "llama-3.3-70b-versatile",
                        messages: [{ role: "user", content: prompt + "\n\nIMPORTANT: Return ONLY valid JSON." }],
                        temperature: 0.3
                    })
                });

                const dataText = await res.text();
                if (!dataText) throw new Error("Empty response");

                let parsed = tryParse(dataText);
                let content = "";

                if (parsed && parsed.choices && parsed.choices[0] && parsed.choices[0].message) {
                    content = parsed.choices[0].message.content;
                } else {
                    content = dataText;
                }

                // (Fixed) Removed false positive error check
                if (content.startsWith("Error:") || content.includes("Rate limit exceeded")) {
                    status.innerText = "âš ï¸ Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„Ø®Ø§Ø¯Ù… Ù…Ø´ØºÙˆÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹.";
                    return;
                }

                const json = tryParse(cleanText(content));
                if (!json) throw new Error("JSON Parsing failed");

                let html = `
                    <p><strong>Ø§Ù„ØªØ­Ù„ÙŠÙ„:</strong> ${json.analysis || ''}</p>
                    
                    <div class="section-title">â­ Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© (Core Skills)</div>
                    <div class="skill-list">${(json.core_skills || []).map(s => `<div class="skill-item">${s}</div>`).join('')}</div>

                    <div class="section-title">ğŸ’» Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±Ù‚Ù…ÙŠØ© ÙˆØ§Ù„ØªÙ‚Ù†ÙŠØ©</div>
                    <div class="skill-list">${(json.tech_skills || []).map(s => `<div class="skill-item">${s}</div>`).join('')}</div>

                    <div class="section-title">ğŸ¤ Ù…Ù‡Ø§Ø±Ø§Øª Ø³Ù„ÙˆÙƒÙŠØ© ÙˆØªÙˆØ§ØµÙ„</div>
                    <div class="skill-list">${(json.soft_skills || []).map(s => `<div class="skill-item">${s}</div>`).join('')}</div>

                    <div class="section-title">ğŸ› ï¸ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© (Software/Tools)</div>
                    <p>${(json.tools || []).join(' - ')}</p>

                    <div class="section-title">ğŸ“œ Ø´Ù‡Ø§Ø¯Ø§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ© ÙŠÙ†ØµØ­ Ø¨Ù‡Ø§</div>
                    <ul style="list-style-type:none; padding:0;">${(json.certifications || []).map(c => `<li style="background:#fff; border:1px solid #ddd; padding:8px; margin-bottom:5px; border-radius:5px;">ğŸ… ${c}</li>`).join('')}</ul>

                    <div class="section-title">ğŸ“… Ø®Ø·Ø© Ø§Ù„ØªØ¹Ù„Ù… Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©</div>
                    <p><strong>Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ù‚Ø±ÙŠØ¨:</strong> ${json.learning_plan?.short_term || ''}</p>
                    <p><strong>Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ù…ØªÙˆØ³Ø·:</strong> ${json.learning_plan?.medium_term || ''}</p>
                    <p><strong>Ø§Ù„Ù…Ø¯Ù‰ Ø§Ù„Ø¨Ø¹ÙŠØ¯:</strong> ${json.learning_plan?.long_term || ''}</p>

                    <div class="section-title" style="color:#d32f2f; border-color:#d32f2f;">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</div>
                    <ul>${(json.warnings || []).map(w => `<li>${w}</li>`).join('')}</ul>
                `;

                document.getElementById('analysisContent').innerHTML = html;
                document.getElementById('resultArea').style.display = 'block';
                status.innerText = "âœ… Ø§ÙƒØªÙ…Ù„ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø®Ø·Ø©!";
                window.scrollTo({ top: document.getElementById('resultArea').offsetTop - 50, behavior: 'smooth' });

            } catch (e) {
                console.error("AI Error:", e);
                status.innerText = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.";
            } finally {
                btn.disabled = false;
            }
        };
        document.getElementById('exportBtn').onclick = () => {
            ProtectionManager.verify(() => window.print());
        };
    </script>
</body>

</html>